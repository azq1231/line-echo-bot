import{r as _,o as g,b as l,d as o,e as s,f as h,i as n,t as i,n as y,F as w,h as x,l as k}from"./runtime-dom.esm-bundler-jAXvPR8n.js";import{_ as C}from"./_plugin-vue_export-helper-DbVkZhGN.js";import{a as v}from"./index-R-lXtGyY.js";const E={class:"container mt-4"},I={class:"d-flex justify-content-between align-items-center mb-4"},L=["disabled"],M={key:1,class:"text-center py-5"},N={key:2,class:"text-center py-5 bg-light rounded"},$={key:3,class:"row row-cols-1 row-cols-lg-2 g-4"},B={class:"card h-100 shadow-sm"},D={class:"card-header bg-light fw-bold"},S={class:"text-primary"},V={class:"card-body"},z={class:"row g-3 align-items-center"},A={class:"col-md-5"},F={class:"border p-3 rounded bg-light h-100 d-flex flex-column"},T={class:"card-text fw-bold fs-5"},U={class:"card-text small text-muted mt-auto"},j={class:"col-md-5"},q={class:"border p-3 rounded h-100 d-flex flex-column"},G={class:"card-text fw-bold fs-5"},H={class:"card-text small text-muted mt-auto"},J={class:"card-footer text-end"},K=["onClick","disabled"],O={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},P={key:1,class:"bi bi-person-plus-fill me-1"},Q={__name:"MergeUsers",setup(X){const c=_([]),d=_(!0),m=_({}),u=_({message:"",type:"info"}),b=(a,e="success",t=4e3)=>{u.value={message:a,type:e},setTimeout(()=>{u.value={message:"",type:"info"}},t)},p=async()=>{d.value=!0;try{const a=await v.get("/api/admin/users/merge_suggestions");if(a.data.status==="success")c.value=a.data.suggestions;else throw new Error(a.data.message||"載入建議失敗")}catch(a){b(`❌ 載入合併建議時發生錯誤: ${a.message}`,"danger")}finally{d.value=!1}},f=async(a,e,t)=>{if(confirm(`確定要將臨時用戶的資料合併到 LINE 用戶嗎？

來源 (將被刪除): ${c.value[t].source.name}
目標 (將被保留): ${c.value[t].target.name}

此操作無法復原。`)){m.value[t]=!0;try{const r=await v.post("/api/admin/users/merge",{source_user_id:a,target_user_id:e});if(r.data.status==="success")b("✅ 用戶已成功合併！","success"),c.value.splice(t,1);else throw new Error(r.data.message||"合併失敗")}catch(r){b(`❌ 合併失敗: ${r.message}`,"danger")}finally{m.value[t]=!1}}};return g(()=>{p()}),(a,e)=>(o(),l("div",E,[s("div",I,[e[2]||(e[2]=s("h1",null,[s("i",{class:"bi bi-person-plus-fill me-2"}),n("用戶合併建議 ")],-1)),s("div",null,[e[1]||(e[1]=s("a",{href:"/admin/users",class:"btn btn-outline-secondary me-2"},[s("i",{class:"bi bi-arrow-left"}),n(" 返回用戶列表 ")],-1)),s("button",{class:"btn btn-primary",onClick:p,disabled:d.value},[e[0]||(e[0]=s("i",{class:"bi bi-arrow-clockwise me-1"},null,-1)),n(" "+i(d.value?"載入中...":"重新整理"),1)],8,L)])]),u.value.message?(o(),l("div",{key:0,class:y(["alert",u.value.type==="success"?"alert-success":"alert-danger"]),role:"alert"},i(u.value.message),3)):h("",!0),d.value?(o(),l("div",M,[...e[3]||(e[3]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),s("p",{class:"mt-2"},"正在分析用戶資料...",-1)])])):c.value.length===0?(o(),l("div",N,[...e[4]||(e[4]=[s("i",{class:"bi bi-check-circle-fill fs-1 text-success"},null,-1),s("h4",{class:"mt-3"},"太棒了！",-1),s("p",{class:"text-muted"},"目前沒有找到可合併的用戶建議。",-1)])])):(o(),l("div",$,[(o(!0),l(w,null,x(c.value,(t,r)=>(o(),l("div",{key:t.source.user_id,class:"col"},[s("div",B,[s("div",D,[n(" 建議 "+i(r+1)+" - ",1),s("span",S,i(t.reason),1)]),s("div",V,[s("div",z,[s("div",A,[s("div",F,[e[5]||(e[5]=s("h6",{class:"card-subtitle mb-2 text-muted"},[s("i",{class:"bi bi-person-fill-gear me-1"}),n("臨時用戶 (來源) ")],-1)),s("p",T,i(t.source.name),1),s("p",U,"ID: "+i(t.source.user_id.substring(0,12))+"...",1)])]),e[7]||(e[7]=s("div",{class:"col-md-2 text-center"},[s("i",{class:"bi bi-arrow-right-circle-fill fs-2 text-success"})],-1)),s("div",j,[s("div",q,[e[6]||(e[6]=s("h6",{class:"card-subtitle mb-2 text-muted"},[s("i",{class:"bi bi-person-check-fill me-1"}),n("LINE 用戶 (目標) ")],-1)),s("p",G,i(t.target.name),1),s("p",H,"ID: "+i(t.target.user_id.substring(0,12))+"...",1)])])])]),s("div",J,[s("button",{class:"btn btn-success",onClick:Y=>f(t.source.user_id,t.target.user_id,r),disabled:m.value[r]},[m.value[r]?(o(),l("span",O)):(o(),l("i",P)),e[8]||(e[8]=n(" 合併 ",-1))],8,K)])])]))),128))]))]))}},R=C(Q,[["__scopeId","data-v-c38a02eb"]]);async function W(){k(R).mount("#app")}W();
